# 함수형 자바스크립트 프로그래밍 :pencil:

## 4. 함수 조립하기

> 4장에서는 작은 함수로 큰 함수를 만드는 방법들을 다룬다. 객체 지향에 빗대어 표현하면 클래스와 인스턴스에 대해서 처음 다루는 장이라고도 할 수 있겠다. 함수로 함수를 조립하는 방법들에 대해 확인해 보자. 

> 함수형 자바스크립트의 10가지 기법
> 1. 함수를 되도록 작게 만들기
> 2. 다형성 높은 함수 만들기
> 3. 상태를 변경하지 않거나 정확히 다루어 부수 효과를 최소화하기
> 4. 동일한 인자를 받으면 항상 동일한 결과를 리턴하는 순수 함수 만들기
> 5. 복잡한 객체 하나를 인자로 사용하기 보다는 되도록 일반적인 값 여러 개를 인자로 사용하기
> 6. 큰 로직을 고차함수로 만들고 세부 로직을 보조함수로 완성하기
> 7. 어느 곳에서든 바로 실행하거나 혹은 미뤄서 실행할 수 있도록 일반 함수이자 순수함수로 선언하기
> 8. 모델이나 컬렉션 등의 커스텀 객체 보다는 기본 객체를 이용하기
> 9. 로직의 흐름을 최대한 단방향으로 흐르게 하기
> 10. 작은 함수를 모아 큰 함수 만들기

### 4.3 연속적인 함수 실행

#### 4.3.1 체인의 아쉬운 점

> 체인의 장점:
> 체인은 메서드를 연속적으로 실행하면서 객체의 상태를 변경해 나가는 기법이다.
> 체인은 표현력이 좋고, 실행 순서를 눈으로 따라가기에도 좋다.

> 체인의 단점:
> 체인 객체가 가지고 있는 메소드만을 이용할 수 있기 때문에 체인 객체와 연관없는 로직이나 다른 재료를 중간에 섞어 사용하기 어렵다.

> 체인이 잘 쓰일수 있는 상황
> 1. DOM과 같이 지속적으로 존재하고 변화의 범위가 많은 주제는 체인과 잘어울린다.
> 2. JQuery의 체인은 좋은 사례

> 체인의 설계가 어려운 이유
> - 내부에서 상태를 관리하며 메서드들이 서로 합을 잘 이루어 동작해 나가도록 설계를 잘 해 두는 일은 생각보다 쉽지않다.
> - 체인 방식은 객체가 생성되어야만 메서드를 사용할 수 있기 때문에 반드시 생성 단계를 거쳐야 한다.
> - this 등의 상태와 흐름과 깊이에 의존하기 때문에 언제 어디서나 아무때나 사용이 가능한 순수함수 보다는 접근성면에서 좀 불편 하다.

#### 4.3.2 _compose의 아쉬운점

- 함수가 오른쪽부터 왼쪽으로 실행되므로 읽기가 어려울 수 있다.

#### 4.3.3 파이프라인

- compose의 장점을 그대로 가지고 있다.
- 함수 실행이 왼쪽에서 오른쪽이다.
- 체인과 달리, 아무 함수나 사용할수 있어 자유도가 높다.

```javascript
_.pipeline = function() {
  var funs = arguments; // (1) 함수들
  return function(seed) {  // (2) 첫 인자
    return _.reduce(funs,
      function(l, r) { return r(l); }, // (4) 모든 함수들을 연속적으로 실행
      seed); // (3) 첫 인자 전달
  };
};
var div_square = _.pipeline(
  function(a) {
    return a / 2;
  },
  function(a) {
    return a * a;
  });
console.log(div_square(6));
// 9
```

#### 4.3.4 클래스를 대신하는 파이프라인

- _pipeline은 작은 함수들을 모아 큰 함수를 만드는 함수
- 클래스와 기능직연 면과 개념적인 면이 다르지만 비슷한 역할 대신 가능
    - 그 이유: 작은 함수들을 조합하여 큰함수들을 만들고 함수 조합을 조금씩 변경하거나 추가하면서 새로운 로직을 만들어 갈 수 있음.

> 예시
```javascript
var users = [];
var companies = [];
function joined_at(attrs) {
  return _.extend(attrs, { joined_at: new Date() });
}
function greeting(member) {
  return member.name + " 회원님은 " + member.id + "번째 회원이십니다. 환영합니다.";
}
var join_user = _.pipeline(
  joined_at,
  function(member) {
    users.push(member);
    member.id = users.length;
    return member;
  },
  greeting);
var join_company = _.pipeline(
  joined_at,
  function(member) {
    companies.push(member);
    member.id = companies.length;
    return member;
  },
  greeting);
console.log( join_user({ name: "ID" }) );
// ID 회원님은 1번째 회원이십니다. 환영합니다.
console.log( join_user({ name: "JI" }) );
// JI 회원님은 2번째 회원이십니다. 환영합니다.
console.log( join_company({ name: "MARPPLE" }) );
// MARPPLE 회원님은 1번째 회원이십니다. 환영합니다.
```
- 여기서 알수 있는 중요한 시사점
    - 위에서 볼수 있듯, 이런 방식은 로직을 단순하게 한다. 
    - 서로 다른 기능을 하지만 조건문이 없다. 
    - 각자 자신이 해야 할일만 순서대로 수행한다. 
    - 작은 함수는 작성이 쉽고 테스트도 쉬우며 오류도 적다.
    - 앞뒤로 받을 인자와 결과만을 생각하면서 문제를 작게 만들면 문제 해결도 쉬워진다.

- 파이프라인은 객체지향의 계층구조의 상속보다 유연하다.
    - 상속 혹은 조합의 단위가 클래스가 아닌 개별적인 함수들이기 떄문
    - 따라서 자유롭게 필요한 기능들을 조합할 수 있음

#### 4.3.5 더 나은 파이프라인, 그리고 Multiple results

- 함수형 자바스크립트는 순수 함수를 많이 사용 할 수록, 인자들을 적극 활용할수록 강력해진다.
- multiple results 기법은 함수의 결과값을 여러개로 return하는 기법

> multiple results 쪽은 다시보기..